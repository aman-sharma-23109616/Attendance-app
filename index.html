<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rajdhani Class Manager</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .modal-animate { animation: zoom 0.2s ease-out; }
        @keyframes zoom { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const INITIAL_STUDENTS = [
            { id: 1, rollNo: "8501", name: "Kishan Kumar", status: "absent" },
            { id: 2, rollNo: "8502", name: "Aman Kumar", status: "absent" },
            { id: 3, rollNo: "8503", name: "Apurv Singh", status: "absent" },
            { id: 4, rollNo: "8505", name: "Nishant", status: "absent" },
            { id: 5, rollNo: "8508", name: "Aman Sharma", status: "absent" },
            { id: 6, rollNo: "8509", name: "Pawan Jat", status: "absent" },
            { id: 7, rollNo: "8511", name: "Ashu Ojha", status: "absent" },
            { id: 8, rollNo: "8512", name: "Vinit Kumar", status: "absent" },
            { id: 9, rollNo: "8514", name: "Jaya Kumari", status: "absent" },
            { id: 10, rollNo: "8515", name: "Yuvansh Raj", status: "absent" },
            { id: 11, rollNo: "8516", name: "Sachin Kumar", status: "absent" },
            { id: 12, rollNo: "8518", name: "Harsh", status: "absent" },
            { id: 13, rollNo: "8519", name: "Mridula", status: "absent" },
            { id: 14, rollNo: "8520", name: "Harsh Singh", status: "absent" },
            { id: 15, rollNo: "8521", name: "Ajay", status: "absent" },
            { id: 16, rollNo: "8523", name: "Abhinav Jha", status: "absent" },
            { id: 17, rollNo: "8524", name: "Harsh Yadav", status: "absent" },
            { id: 18, rollNo: "8525", name: "Aditya Kadian", status: "absent" },
            { id: 19, rollNo: "8529", name: "Akshay Bisht", status: "absent" },
            { id: 20, rollNo: "8533", name: "Subhash Kumar", status: "absent" },
            { id: 21, rollNo: "8535", name: "Arjun", status: "absent" },
            { id: 22, rollNo: "8538", name: "Fidha Thasneem", status: "absent" },
            { id: 23, rollNo: "8545", name: "Lalita", status: "absent" },
            { id: 24, rollNo: "8546", name: "Yash Raj Mathur", status: "absent" },
            { id: 25, rollNo: "8547", name: "Priyanshu", status: "absent" },
            { id: 26, rollNo: "8548", name: "Manjeet Sharma", status: "absent" },
            { id: 27, rollNo: "8549", name: "Aman Yadav", status: "absent" },
            { id: 28, rollNo: "8550", name: "Jateen Kumar", status: "absent" },
            { id: 29, rollNo: "8551", name: "Ritik Kumar Sharma", status: "absent" },
            { id: 30, rollNo: "8552", name: "Harshit Kumar", status: "absent" },
            { id: 31, rollNo: "8553", name: "Dhruv Kumar", status: "absent" },
            { id: 32, rollNo: "8555", name: "Prashant Kumar", status: "absent" },
            { id: 33, rollNo: "8556", name: "Jitender Kumar", status: "absent" },
            { id: 34, rollNo: "8557", name: "Supriya Singh", status: "absent" },
            { id: 35, rollNo: "8558", name: "Mohd Kashif", status: "absent" },
            { id: 36, rollNo: "8561", name: "Saksham Kumar Sah", status: "absent" },
            { id: 37, rollNo: "8562", name: "Aditya Kumar Shah", status: "absent" },
            { id: 38, rollNo: "8563", name: "Deepak Kumar", status: "absent" },
            { id: 39, rollNo: "8564", name: "Shreyanka Panda", status: "absent" },
            { id: 40, rollNo: "8565", name: "Harsh Tiwari", status: "absent" },
            { id: 41, rollNo: "8566", name: "Shivanshu Upadhayay", status: "absent" },
            { id: 42, rollNo: "8568", name: "Amit Kumar", status: "absent" },
            { id: 43, rollNo: "8569", name: "Shruti Thapa", status: "absent" },
            { id: 44, rollNo: "8574", name: "Hemant Kumar", status: "absent" },
            { id: 45, rollNo: "8576", name: "Sohail", status: "absent" },
            { id: 46, rollNo: "8577", name: "Amisha Jha", status: "absent" },
            { id: 47, rollNo: "8578", name: "Anshika", status: "absent" }
        ];

        const DEFAULT_CLASSES = [
            { id: 'default-1', name: "B.Sc. Physical Science", students: INITIAL_STUDENTS }
        ];

        function App() {
            const [classes, setClasses] = useState(() => {
                const saved = localStorage.getItem('rajdhani_multi_class');
                return saved ? JSON.parse(saved) : DEFAULT_CLASSES;
            });

            const [currentClassId, setCurrentClassId] = useState(null);
            const [isAddingClass, setIsAddingClass] = useState(false);
            const [newClassName, setNewClassName] = useState("");

            const [searchTerm, setSearchTerm] = useState("");
            const [isAddingStudent, setIsAddingStudent] = useState(false);
            const [studentName, setStudentName] = useState("");
            const [studentRoll, setStudentRoll] = useState("");

            useEffect(() => {
                localStorage.setItem('rajdhani_multi_class', JSON.stringify(classes));
            }, [classes]);

            const currentClass = useMemo(() => 
                classes.find(c => c.id === currentClassId), 
            [classes, currentClassId]);

            const stats = useMemo(() => {
                if (!currentClass) return { present: 0, total: 0, percent: 0 };
                const present = currentClass.students.filter(s => s.status === 'present').length;
                const total = currentClass.students.length;
                const percent = total > 0 ? Math.round((present / total) * 100) : 0;
                return { present, total, percent };
            }, [currentClass]);

            const handleCreateClass = (e) => {
                e.preventDefault();
                if (!newClassName) return;
                const newClass = { id: Date.now().toString(), name: newClassName, students: [] };
                setClasses([...classes, newClass]);
                setNewClassName("");
                setIsAddingClass(false);
            };

            const handleDeleteClass = (id) => {
                if (confirm("Delete this entire class and all its student records?")) {
                    setClasses(classes.filter(c => c.id !== id));
                }
            };

            const toggleAttendance = (studentId) => {
                setClasses(classes.map(c => {
                    if (c.id === currentClassId) {
                        return {
                            ...c,
                            students: c.students.map(s => s.id === studentId ? { ...s, status: s.status === 'present' ? 'absent' : 'present' } : s)
                        };
                    }
                    return c;
                }));
            };

            const markAll = (status) => {
                if (confirm(`Mark all as ${status.toUpperCase()}?`)) {
                    setClasses(classes.map(c => {
                        if (c.id === currentClassId) {
                            return { ...c, students: c.students.map(s => ({ ...s, status })) };
                        }
                        return c;
                    }));
                }
            };

            const handleAddStudent = (e) => {
                e.preventDefault();
                if (!studentName || !studentRoll) return;
                setClasses(classes.map(c => {
                    if (c.id === currentClassId) {
                        return {
                            ...c,
                            students: [...c.students, { id: Date.now(), name: studentName, rollNo: studentRoll, status: 'absent' }]
                        };
                    }
                    return c;
                }));
                setStudentName(""); setStudentRoll(""); setIsAddingStudent(false);
            };

            const handleDeleteStudent = (sid) => {
                if (confirm("Remove this student?")) {
                    setClasses(classes.map(c => {
                        if (c.id === currentClassId) {
                            return { ...c, students: c.students.filter(s => s.id !== sid) };
                        }
                        return c;
                    }));
                }
            };

            const exportPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const today = new Date().toLocaleDateString('en-IN');
                
                doc.setFontSize(16);
                doc.setTextColor(79, 70, 229);
                doc.text(`${currentClass.name} - Attendance`, 14, 20);
                
                doc.setFontSize(10);
                doc.setTextColor(100);
                doc.text(`Date: ${today} | Present: ${stats.present}/${stats.total}`, 14, 28);
                
                const tableData = currentClass.students.map(s => [s.rollNo, s.name, s.status.toUpperCase()]);
                doc.autoTable({
                    head: [['Roll No', 'Student Name', 'Status']],
                    body: tableData,
                    startY: 35,
                    headStyles: { fillColor: [79, 70, 229] },
                    didParseCell: (data) => {
                        if (data.section === 'body' && data.column.index === 2) {
                            data.cell.styles.textColor = data.cell.raw === 'PRESENT' ? [16, 185, 129] : [239, 68, 68];
                        }
                    }
                });
                doc.save(`${currentClass.name}_Attendance_${today}.pdf`);
            };

            // --- RENDER VIEWS ---

            if (!currentClassId) {
                return (
                    <div className="min-h-screen p-6 max-w-xl mx-auto">
                        <header className="mb-8">
                            <h1 className="text-3xl font-bold text-indigo-600">My Classes</h1>
                            <p className="text-slate-500 text-sm mt-1">Select a class to take attendance</p>
                        </header>

                        <div className="grid gap-4">
                            {classes.map(c => (
                                <div key={c.id} className="bg-white p-5 rounded-3xl shadow-sm flex items-center justify-between group border border-slate-100 hover:border-indigo-200 transition-all">
                                    <div className="flex-grow cursor-pointer" onClick={() => setCurrentClassId(c.id)}>
                                        <h2 className="font-bold text-lg text-slate-800">{c.name}</h2>
                                        <p className="text-slate-400 text-xs font-semibold uppercase tracking-wider">{c.students.length} Students</p>
                                    </div>
                                    <button onClick={() => handleDeleteClass(c.id)} className="p-2 text-slate-300 hover:text-rose-500 transition-colors">
                                        üóëÔ∏è
                                    </button>
                                </div>
                            ))}
                        </div>

                        <button 
                            onClick={() => setIsAddingClass(true)}
                            className="mt-8 w-full py-4 bg-indigo-600 text-white rounded-2xl font-bold shadow-lg shadow-indigo-100 flex items-center justify-center gap-2"
                        >
                            <span className="text-xl">+</span> Add New Class
                        </button>

                        {isAddingClass && (
                            <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                                <form onSubmit={handleCreateClass} className="bg-white w-full max-w-sm rounded-3xl p-6 modal-animate">
                                    <h2 className="text-xl font-bold mb-4">Create New Class</h2>
                                    <input autoFocus required className="w-full p-4 bg-slate-50 rounded-2xl outline-none border border-slate-100 focus:border-indigo-400" placeholder="e.g. B.Sc. Physics" value={newClassName} onChange={e => setNewClassName(e.target.value)} />
                                    <div className="flex gap-2 mt-6">
                                        <button type="button" onClick={() => setIsAddingClass(false)} className="flex-1 p-4 font-bold text-slate-400">Cancel</button>
                                        <button type="submit" className="flex-1 p-4 bg-indigo-600 text-white rounded-xl font-bold">Create</button>
                                    </div>
                                </form>
                            </div>
                        )}
                    </div>
                );
            }

            const filtered = currentClass.students.filter(s => 
                s.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                s.rollNo.includes(searchTerm)
            );

            return (
                <div className="min-h-screen pb-24 flex flex-col items-center">
                    <header className="bg-indigo-600 text-white w-full p-6 sticky top-0 z-10 shadow-lg">
                        <div className="max-w-xl mx-auto">
                            <div className="flex justify-between items-start mb-4">
                                <button onClick={() => setCurrentClassId(null)} className="text-white/80 font-bold text-sm flex items-center gap-1">
                                    ‚Üê Classes
                                </button>
                                <div className="flex gap-2">
                                    <button onClick={exportPDF} className="bg-white/20 p-2 rounded-lg text-[10px] font-bold">PDF</button>
                                    <button onClick={() => setIsAddingStudent(true)} className="bg-white text-indigo-600 p-2 rounded-lg font-bold">Add Student</button>
                                </div>
                            </div>
                            <h1 className="text-xl font-bold truncate">{currentClass.name}</h1>
                            <div className="mt-4 flex gap-2 items-center">
                                <div className="flex-1 bg-white/10 rounded-xl p-3 border border-white/20">
                                    <p className="text-[10px] uppercase opacity-70">Present Today</p>
                                    <p className="text-2xl font-bold">{stats.present} / {stats.total}</p>
                                </div>
                                <button 
                                    onClick={() => markAll(stats.percent === 100 ? 'absent' : 'present')}
                                    className="bg-white/10 hover:bg-white/20 px-4 py-3 rounded-xl text-[10px] font-bold border border-white/20 transition-colors"
                                >
                                    {stats.percent === 100 ? "RESET ALL" : "MARK ALL PRESENT"}
                                </button>
                            </div>
                        </div>
                    </header>

                    <main className="w-full p-4 max-w-xl">
                        <input 
                            type="text"
                            placeholder="Search students..."
                            className="w-full p-4 rounded-2xl border-none shadow-sm mb-4 focus:ring-2 focus:ring-indigo-500 outline-none"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />

                        <div className="space-y-2.5">
                            {filtered.map(s => (
                                <div key={s.id} className={`bg-white p-4 rounded-2xl flex items-center justify-between shadow-sm border-l-4 transition-colors ${s.status === 'present' ? 'border-l-emerald-500' : 'border-l-rose-500'}`}>
                                    <div className="flex-grow">
                                        <div className="font-bold text-slate-800 text-sm leading-tight">{s.name}</div>
                                        <div className="text-xs text-slate-400 font-bold mt-0.5">Roll: {s.rollNo}</div>
                                    </div>
                                    <div className="flex items-center gap-3">
                                        <button onClick={() => handleDeleteStudent(s.id)} className="p-2 opacity-10 hover:opacity-100">üóëÔ∏è</button>
                                        <button 
                                            onClick={() => toggleAttendance(s.id)}
                                            className={`min-w-[90px] py-2.5 rounded-xl font-bold text-[10px] tracking-wider transition-all active:scale-95 shadow-sm ${
                                                s.status === 'present' ? 'bg-emerald-500 text-white' : 'bg-rose-500 text-white'
                                            }`}
                                        >
                                            {s.status.toUpperCase()}
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </main>

                    {isAddingStudent && (
                        <div className="fixed inset-0 bg-slate-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                            <form onSubmit={handleAddStudent} className="bg-white w-full max-w-sm rounded-3xl p-6 modal-animate shadow-2xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-lg font-bold">New Student Entry</h2>
                                    <button type="button" onClick={() => setIsAddingStudent(false)} className="text-slate-400 text-3xl">&times;</button>
                                </div>
                                <div className="space-y-4">
                                    <input autoFocus required className="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl outline-none" placeholder="Full Name" value={studentName} onChange={e => setStudentName(e.target.value)} />
                                    <input required className="w-full p-4 bg-slate-50 border border-slate-100 rounded-xl outline-none" placeholder="Roll Number" value={studentRoll} onChange={e => setStudentRoll(e.target.value)} />
                                    <button type="submit" className="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg mt-2">Add Student</button>
                                </div>
                            </form>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

