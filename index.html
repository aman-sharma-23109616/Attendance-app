<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Attendance Pro</title>
    <!-- CSS and Fonts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .modal-animate { animation: zoom 0.2s ease-out; }
        @keyframes zoom { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- React, Babel, and PDF Libraries -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        function App() {
            // Initialize from LocalStorage
            const [students, setStudents] = useState(() => {
                const saved = localStorage.getItem('attendance_data');
                return saved ? JSON.parse(saved) : [
                    { id: 1, name: "Sample Student", rollNo: "101", status: "present" }
                ];
            });

            const [searchTerm, setSearchTerm] = useState("");
            const [isAdding, setIsAdding] = useState(false);
            const [newName, setNewName] = useState("");
            const [newRoll, setNewRoll] = useState("");

            // Save to LocalStorage whenever students change
            useEffect(() => {
                localStorage.setItem('attendance_data', JSON.stringify(students));
            }, [students]);

            const stats = useMemo(() => {
                const present = students.filter(s => s.status === 'present').length;
                const total = students.length;
                const percent = total > 0 ? Math.round((present / total) * 100) : 0;
                return { present, total, percent };
            }, [students]);

            const toggleAttendance = (id) => {
                setStudents(students.map(s => s.id === id ? { ...s, status: s.status === 'present' ? 'absent' : 'present' } : s));
            };

            const addStudent = (e) => {
                e.preventDefault();
                if (!newName || !newRoll) return;
                setStudents([...students, { id: Date.now(), name: newName, rollNo: newRoll, status: 'present' }]);
                setNewName(""); setNewRoll(""); setIsAdding(false);
            };

            const deleteStudent = (id) => {
                if(confirm("Delete this student?")) {
                    setStudents(students.filter(s => s.id !== id));
                }
            };

            const exportPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const today = new Date().toLocaleDateString();
                
                doc.setFontSize(18);
                doc.text("Attendance Report", 14, 20);
                doc.setFontSize(10);
                doc.text(`Date: ${today} | Present: ${stats.present}/${stats.total}`, 14, 28);
                
                const tableData = students.map(s => [s.rollNo, s.name, s.status.toUpperCase()]);
                doc.autoTable({
                    head: [['Roll No', 'Student Name', 'Status']],
                    body: tableData,
                    startY: 35,
                    headStyles: { fillColor: [79, 70, 229] }
                });
                doc.save(`Attendance_${today}.pdf`);
            };

            const filtered = students.filter(s => 
                s.name.toLowerCase().includes(searchTerm.toLowerCase()) || 
                s.rollNo.includes(searchTerm)
            );

            return (
                <div className="min-h-screen pb-24">
                    {/* Header */}
                    <header className="bg-indigo-600 text-white p-6 sticky top-0 z-10 shadow-md">
                        <div className="flex justify-between items-center mb-6">
                            <div>
                                <h1 className="text-2xl font-bold">Attendance</h1>
                                <p className="text-indigo-100 text-sm">{new Date().toDateString()}</p>
                            </div>
                            <div className="flex gap-2">
                                <button onClick={exportPDF} className="bg-white/20 p-2 rounded-lg text-sm">PDF</button>
                                <button onClick={() => setIsAdding(true)} className="bg-white text-indigo-600 px-4 py-2 rounded-lg font-bold shadow-lg">+</button>
                            </div>
                        </div>
                        
                        <div className="grid grid-cols-2 gap-3">
                            <div className="bg-white/10 rounded-xl p-3 border border-white/20">
                                <p className="text-[10px] uppercase opacity-80">Present</p>
                                <p className="text-2xl font-bold">{stats.present} <span className="text-sm font-normal opacity-60">/ {stats.total}</span></p>
                            </div>
                            <div className="bg-white/10 rounded-xl p-3 border border-white/20 text-right">
                                <p className="text-[10px] uppercase opacity-80">Rate</p>
                                <p className="text-2xl font-bold">{stats.percent}%</p>
                            </div>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="p-4 max-w-lg mx-auto">
                        <input 
                            type="text"
                            placeholder="Search name or roll..."
                            className="w-full p-4 rounded-2xl border-none shadow-sm mb-4 sticky top-40 bg-white"
                            value={searchTerm}
                            onChange={(e) => setSearchTerm(e.target.value)}
                        />

                        <div className="space-y-3">
                            {filtered.map(s => (
                                <div key={s.id} className="bg-white p-4 rounded-2xl flex items-center justify-between shadow-sm border-l-4 border-indigo-500">
                                    <div className="flex-grow">
                                        <div className="font-bold text-slate-800">{s.name}</div>
                                        <div className="text-xs text-slate-500 font-medium">Roll: {s.rollNo}</div>
                                    </div>
                                    <div className="flex items-center gap-4">
                                        <button onClick={() => deleteStudent(s.id)} className="opacity-30 hover:opacity-100">üóëÔ∏è</button>
                                        <button 
                                            onClick={() => toggleAttendance(s.id)}
                                            className={`px-5 py-2 rounded-xl font-bold text-xs transition-all active:scale-90 shadow-sm ${
                                                s.status === 'present' 
                                                ? 'bg-emerald-500 text-white' 
                                                : 'bg-rose-500 text-white'
                                            }`}
                                        >
                                            {s.status.toUpperCase()}
                                        </button>
                                    </div>
                                </div>
                            ))}
                            {filtered.length === 0 && (
                                <div className="text-center py-10 text-slate-400">No students found</div>
                            )}
                        </div>
                    </main>

                    {/* Add Modal */}
                    {isAdding && (
                        <div className="fixed inset-0 bg-slate-900/60 backdrop-blur-sm z-50 flex items-end sm:items-center justify-center p-4">
                            <form onSubmit={addStudent} className="bg-white w-full max-w-md rounded-3xl p-6 modal-animate shadow-2xl">
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold">New Student</h2>
                                    <button type="button" onClick={() => setIsAdding(false)} className="text-slate-400 text-2xl">√ó</button>
                                </div>
                                <div className="space-y-4">
                                    <input autoFocus required className="w-full p-4 bg-slate-100 rounded-xl outline-none" placeholder="Student Name" value={newName} onChange={e => setNewName(e.target.value)} />
                                    <input required className="w-full p-4 bg-slate-100 rounded-xl outline-none" placeholder="Roll Number" value={newRoll} onChange={e => setNewRoll(e.target.value)} />
                                    <button type="submit" className="w-full bg-indigo-600 text-white font-bold py-4 rounded-xl shadow-lg mt-2">Add to Class</button>
                                </div>
                            </form>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

